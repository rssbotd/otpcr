#!/usr/bin/env python3
# This file is placed in the Public Domain.
# pylint: disable=C0413


"cli"


import getpass
import os
import sys


from otpcr.config import Config


Cfg = Config()


from otpcr.command import Commands
from otpcr.errors  import errors
from otpcr.main    import cmnd, enable, wrap
from otpcr.modules import face
from otpcr.parse   import parse
from otpcr.utils   import modnames


Cfg.mod = ",".join(modnames(face))


def srv(event):
    "create service file (pipx)."
    username  = getpass.getuser()
    path = os.path.normpath(f"/home/{username}/.local/bin/")
    txt = f"""[Unit]
Description={Cfg.name.upper()}
After=network.target

[Service]
Type=simple
User={username}
Group={username}
ExecStart={path}/{Cfg.name}s

[Install]
WantedBy=multi-user.target"""
    event.reply(txt)


Commands.add(srv)


def main():
    "main"
    parse(Cfg, " ".join(sys.argv[1:]))
    if "v" in Cfg.opts:
        enable(print)
    if Cfg.txt:
        cmnd(Cfg.otxt, print)


if __name__ == "__main__":
    wrap(main)
    errors()
